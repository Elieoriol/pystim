language: python
branches:
  only:
    - master
python:
  - 2.7
install:
  # prep conda environment
  - sudo apt-get update
  - wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh -O miniconda.sh
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda

  # run through install as written in docs
  - conda create -y -n sp_env python=2.7
  - source activate sp_env
  - conda install -y numpy scipy Pillow matplotlib pandas pyopengl lxml openpyxl configobj sortedcontainers sphinx
  - pip install tabulate igor tqdm moviepy pyglet psychopy labjackpython rst2pdf pyusb pycrafter4500 future
  - conda install -y -c anaconda wxpython=3.0.0.0
  - conda install -y -c conda-forge ffmpeg=3.2.4

before_script:
  # setup virtual frame buffer (i.e. headless display)
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start

script:
  # build documentation
  - cd docs
  - sphinx-build -b html source build/html
  # sphinx-build -W -b html source build/html
  # sphinx-build -W -b pdf source build/pdf

deploy:
  # push html documentation to github pages
  provider: pages
  skip_cleanup: true
  github_token: $travis_sphinx_ghpages
  local_dir: ./build/html
  on:
    branch: master
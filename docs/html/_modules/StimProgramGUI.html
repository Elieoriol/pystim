<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>StimProgramGUI &#8212; Stimulus Program 1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Stimulus Program 1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for StimProgramGUI</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">GUI for StimProgram</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Copyright (C) 2016 Alexander Tomlinson</span>
<span class="c1"># Distributed under the terms of the GNU General Public License (GPL).</span>

<span class="c1"># must first turn pyglet shadow windows off to avoid conflict between wxPython</span>
<span class="c1"># and psychopy.visual on OSX</span>
<span class="kn">import</span> <span class="nn">pyglet</span>
<span class="n">pyglet</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;shadow_window&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">GammaCorrection</span> <span class="k">import</span> <span class="n">GammaValues</span>  <span class="c1"># unused, but necessary for pickling</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="k">import</span> <span class="n">literal_eval</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">platform</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">StimProgram</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">wx.lib.agw.multidirdialog</span> <span class="k">as</span> <span class="nn">mdd</span>
<span class="kn">import</span> <span class="nn">wx</span><span class="o">,</span> <span class="nn">wx.grid</span>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model to hold parameter data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing_param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motion_param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_default_param</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gui_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stim_params</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># init params</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../stimprogram/psychopy/config.ini&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_params</span><span class="p">,</span> <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_config_file</span><span class="p">(</span>
            <span class="n">config_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_params</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.read_config_file"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.read_config_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses ConfigParser to read .ini file where default values for params</span>
<span class="sd">        are stored.</span>

<span class="sd">        :param config_file: file where defaults are stored</span>
<span class="sd">        :return: returns dictionary of defaults</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

        <span class="n">default_config_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">gui_config_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stim_config_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># make dict of options</span>
        <span class="k">for</span> <span class="n">option_dict</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">default_config_dict</span><span class="p">,</span>
                                         <span class="n">gui_config_dict</span><span class="p">,</span>
                                         <span class="n">stim_config_dict</span><span class="p">],</span>
                                        <span class="p">[</span><span class="s1">&#39;Defaults&#39;</span><span class="p">,</span> <span class="s1">&#39;GUI&#39;</span><span class="p">,</span> <span class="s1">&#39;StimProgram&#39;</span><span class="p">]):</span>

            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
                <span class="n">option_dict</span><span class="p">[</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>

            <span class="c1"># cast, for proper set up of controls</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">option_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">option_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameters</span><span class="o">.</span><span class="n">lit_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gui_config_dict</span><span class="p">,</span> <span class="n">stim_config_dict</span><span class="p">,</span> <span class="n">default_config_dict</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Parameters.lit_eval"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.lit_eval">[docs]</a>    <span class="k">def</span> <span class="nf">lit_eval</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to attempt to cast parameters from strings to proper</span>
<span class="sd">        int/float/bool/list. Uses ast.literal_eval(), see relevant</span>
<span class="sd">        documentation.</span>

<span class="sd">        :param value: variable being casted, passed from ini file or gui so</span>
<span class="sd">         always string. Skip if already string</span>
<span class="sd">        :return: casted or unchanged variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>  <span class="c1"># for strings</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Parameters.trans"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.trans">[docs]</a>    <span class="k">def</span> <span class="nf">trans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to go from category to appropriate dictionary</span>

<span class="sd">        :param category: which dictionary the param is in</span>
<span class="sd">        :return: dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shape&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_param</span><span class="p">,</span>
                 <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_param</span><span class="p">,</span>
                 <span class="s1">&#39;fill&#39;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_param</span><span class="p">,</span>
                 <span class="s1">&#39;motion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_param</span><span class="p">,</span>
                 <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_default_param</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">trans</span><span class="p">[</span><span class="n">category</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parameters.get_gammas"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.get_gammas">[docs]</a>    <span class="k">def</span> <span class="nf">get_gammas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter</span>

<span class="sd">        :return: returns list of saved gamma profiles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gamma_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;./psychopy/data/gammaTables.txt&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">gamma_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gamma_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">gamma_dict</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">gamma_mons</span> <span class="o">=</span> <span class="n">gamma_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gamma_mons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">gamma_mons</span></div>

<div class="viewcode-block" id="Parameters.get_global_params"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.get_global_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter.</span>

<span class="sd">        :return: dictionary of default values from global defaults</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">global_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_default_param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">global_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_default_param</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">global_dict</span></div>

<div class="viewcode-block" id="Parameters.get_merged_params"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.get_merged_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_merged_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter.</span>

<span class="sd">        :return: dictionary of default values from dicts other than global</span>
<span class="sd">         defaults</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merged_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">param_dict</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_param</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">timing_param</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">fill_param</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">motion_param</span><span class="p">]:</span>

            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">merged_params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">merged_params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.set_param_value"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.set_param_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_param_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter</span>

<span class="sd">        :param category: which dictionary the param is in</span>
<span class="sd">        :param param: the param to be edited</span>
<span class="sd">        :param value: the value the param is being set to</span>
<span class="sd">        :param index: if a list value param, where in the list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">Parameters</span><span class="o">.</span><span class="n">lit_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trans</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trans</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

        <span class="c1"># print &#39;{} set to {}.&#39;.format(param, repr(trans[param][&#39;default&#39;]))</span>

<div class="viewcode-block" id="Parameters.get_param_value"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.get_param_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_param_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter</span>

<span class="sd">        :param category: which dictionary the param is in</span>
<span class="sd">        :param param: the param to be returned</span>
<span class="sd">        :param index: if a list value param, where in the list</span>
<span class="sd">        :return: the currently set parameter value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trans</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trans</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parameters.init_params"><a class="viewcode-back" href="../gui.html#StimProgramGUI.Parameters.init_params">[docs]</a>    <span class="k">def</span> <span class="nf">init_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes dictionaries of parameters from json</span>

<span class="sd">        :param config_dict: dictionary of defaults</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../stimprogram/psychopy/params_json.txt&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">)</span>

        <span class="c1"># set defaults</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">param</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shape_param</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;shape_param&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing_param</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;timing_param&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_param</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fill_param&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motion_param</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion_param&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_default_param</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;global_default_param&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="TextCtrlTag"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlTag">[docs]</a><span class="k">class</span> <span class="nc">TextCtrlTag</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple subclass of wx.TextCtrl for assigning ID tag to class to keep</span>
<span class="sd">    track of which parameter it was assigned to. Also has method to set value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># pop out tag and tag2 if present from args/kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># tag2 used in list type parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag2</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tag2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                             <span class="n">validator</span><span class="o">=</span><span class="n">TextCtrlValidator</span><span class="p">(),</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="TextCtrlTag.set_value"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlTag.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to change the value in the control.</span>

<span class="sd">        :param value: value to be changed to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="TextCtrlTag.set_editable"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlTag.set_editable">[docs]</a>    <span class="k">def</span> <span class="nf">set_editable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toggle</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles whether or not control is editable.</span>

<span class="sd">        :param toggle: True or False, whether control is editable.</span>
<span class="sd">        :param value: When making editable, what to set value to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ChangeValue</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetEditable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ChoiceCtrlTag"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ChoiceCtrlTag">[docs]</a><span class="k">class</span> <span class="nc">ChoiceCtrlTag</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Choice</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple subclass of wx.Choice for assigning ID tag to class to keep</span>
<span class="sd">    track of which parameter it was assigned to. Also method to set value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># pop out tag if present from args/kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Choice</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ChoiceCtrlTag.set_value"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ChoiceCtrlTag.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to change the value in the control.</span>

<span class="sd">        :param value: value to be changed to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print &#39;set choice&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">evt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CommandEvent</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHOICE</span><span class="o">.</span><span class="n">typeId</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">SetEventObject</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">SetString</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetEventHandler</span><span class="p">()</span><span class="o">.</span><span class="n">ProcessEvent</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChoiceCtrlTag.set_editable"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ChoiceCtrlTag.set_editable">[docs]</a>    <span class="k">def</span> <span class="nf">set_editable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toggle</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles whether or not control is editable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FilePickerCtrlTag"><a class="viewcode-back" href="../gui.html#StimProgramGUI.FilePickerCtrlTag">[docs]</a><span class="k">class</span> <span class="nc">FilePickerCtrlTag</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">FilePickerCtrl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple subclass of wx.FilePickerCtrl for assigning ID tag to class to keep</span>
<span class="sd">    track of which parameter it was assigned to. Also method to set value,</span>
<span class="sd">    which requires category variable to know which panel control is in to</span>
<span class="sd">    edit parameters accordingly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># pop out tag if present from args/kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">FilePickerCtrl</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                   <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Path to file&#39;</span><span class="p">,</span>
                                   <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FLP_USE_TEXTCTRL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FLP_SMALL</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="FilePickerCtrlTag.set_value"><a class="viewcode-back" href="../gui.html#StimProgramGUI.FilePickerCtrlTag.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to change the value in the control.</span>

<span class="sd">        :param value: value to be changed to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetPath</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># set path does not simulate event, so need to manually change</span>
        <span class="c1"># in parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetTopLevelParent</span><span class="p">()</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                            <span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TextCtrlValidator"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlValidator">[docs]</a><span class="k">class</span> <span class="nc">TextCtrlValidator</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PyValidator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validator class to ensure proper entry of parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normal init.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PyValidator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="TextCtrlValidator.Clone"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlValidator.Clone">[docs]</a>    <span class="k">def</span> <span class="nf">Clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Standard cloner. All validators are required to implement the Clone()</span>
<span class="sd">        method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TextCtrlValidator</span><span class="p">()</span></div>

<div class="viewcode-block" id="TextCtrlValidator.Validate"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlValidator.Validate">[docs]</a>    <span class="k">def</span> <span class="nf">Validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate contents of given TextCtrl.</span>

<span class="sd">        :param win:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetWindow</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">text_box</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">text_box</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
            <span class="n">text_box</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">text_box</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
                <span class="n">text_box</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">text_box</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s1">&#39;pink&#39;</span><span class="p">)</span>
                <span class="n">text_box</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TextCtrlValidator.TransferToWindow"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlValidator.TransferToWindow">[docs]</a>    <span class="k">def</span> <span class="nf">TransferToWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TextCtrlValidator.TransferFromWindow"><a class="viewcode-back" href="../gui.html#StimProgramGUI.TextCtrlValidator.TransferFromWindow">[docs]</a>    <span class="k">def</span> <span class="nf">TransferFromWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="InputPanel"><a class="viewcode-back" href="../gui.html#StimProgramGUI.InputPanel">[docs]</a><span class="k">class</span> <span class="nc">InputPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for generic panel with input widgets and their labels. Parent class</span>
<span class="sd">    of GlobalPanel.</span>

<span class="sd">    :param params: dictionary of parameters</span>
<span class="sd">    :param parent: parent window of panel (notebook)</span>
<span class="sd">    :param category: category of parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># super instantiation</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InputPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetTopLevelParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

        <span class="c1"># dictionary for list of associated SubPanels to make proper show and</span>
        <span class="c1"># hide calls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_panel_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># dictionary of all controls, including subpanel controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_controls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">all_controls</span>

        <span class="c1"># counters for list and pos in sizer, accessed by SubPanel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># sizer for controls and labels, accessed by SubPanel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GridBagSizer</span><span class="p">(</span><span class="n">hgap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">vgap</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># create inputs and add to sizers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_inputs</span><span class="p">()</span>

        <span class="c1"># nest and place sizers</span>
        <span class="n">panel_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">()</span>
        <span class="n">panel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># set sizer for panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">panel_sizer</span><span class="p">)</span>

<div class="viewcode-block" id="InputPanel.create_inputs"><a class="viewcode-back" href="../gui.html#StimProgramGUI.InputPanel.create_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">create_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to recursively generate label and input widgets.</span>
<span class="sd">        Checks if param is child of another and only generates</span>
<span class="sd">        parent params, then generates subpanel with associated child</span>
<span class="sd">        params. Differentiates between input types (text, dropdown,</span>
<span class="sd">        list (i.e. multiple text fields)).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># iterate through params in param dict</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">param_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1"># only generate fields for params that aren&#39;t children</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;is_child&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;hide&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param_info</span><span class="p">:</span>
                <span class="c1"># label widget</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>

                <span class="n">param_type</span> <span class="o">=</span> <span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

                <span class="c1"># input widgets, depending on type</span>
                <span class="k">if</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;choice&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">]:</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_ctrls</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param_info</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
                    <span class="c1"># get length of list for sizer and TextCtrl sizing</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
                    <span class="c1"># sizer for adding text boxes into grid</span>
                    <span class="n">list_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GridSizer</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">hgap</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

                    <span class="c1"># iterate through number of fields in each list and</span>
                    <span class="c1"># create a TextCtrl for each, with tag2 as the position</span>
                    <span class="c1"># of the input in the param list</span>
                    <span class="c1"># also resize TextCtrl so lengths match up for aesthetic</span>
                    <span class="c1"># purposes</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
                        <span class="n">size</span> <span class="o">=</span> <span class="p">((</span><span class="mi">120</span> <span class="o">/</span> <span class="n">length</span> <span class="o">-</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">length</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ctrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_ctrls</span><span class="p">(</span><span class="n">param</span><span class="p">,</span>
                                               <span class="n">param_info</span><span class="p">,</span>
                                               <span class="n">tag2</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                                               <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
                        <span class="c1"># add to sizer</span>
                        <span class="n">list_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>

                    <span class="c1"># set ctrl to sizer in order to be added to grid_sizer</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="n">list_sizer</span>

                <span class="c1"># add widgets to sizer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_counter</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_counter</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                <span class="c1"># increment counters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_counter</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># check if param has child param</span>
            <span class="k">if</span> <span class="s1">&#39;children&#39;</span> <span class="ow">in</span> <span class="n">param_info</span><span class="p">:</span>
                <span class="c1"># create a new dictionary in sub panel dict for that parameter</span>
                <span class="c1"># because some panels have more than one subpanel, and the</span>
                <span class="c1"># proper subpanel needs to be referenced on calls to Show()</span>
                <span class="c1"># and Hide()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># single box sizer so that subpanels can occupy a single</span>
                <span class="c1"># space in the panel&#39;s gridbox sizer</span>
                <span class="n">subpanel_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

                <span class="c1"># iterate through the dictionary of child params</span>
                <span class="k">for</span> <span class="n">choice</span><span class="p">,</span> <span class="n">child_params</span> <span class="ow">in</span> <span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;children&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="c1"># create new ordered dict to hold only child params</span>
                    <span class="n">child_param_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

                    <span class="c1"># iterate through list of child params and create copy of</span>
                    <span class="c1"># dict entry found in param dict. Need to make copy or</span>
                    <span class="c1"># else changes will make changes in wrong dict</span>
                    <span class="k">for</span> <span class="n">child_param</span> <span class="ow">in</span> <span class="n">child_params</span><span class="p">:</span>
                        <span class="n">child_param_dict</span><span class="p">[</span><span class="n">child_param</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">child_param</span><span class="p">])</span>

                    <span class="c1"># iterate through new child param dict and reset is_child</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">child_param_dict</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                        <span class="n">values</span><span class="p">[</span><span class="s1">&#39;is_child&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="c1"># make sub panel with new dict</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">choice</span><span class="p">]</span> <span class="o">=</span> <span class="n">InputPanel</span><span class="p">(</span>
                        <span class="n">child_param_dict</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>

                <span class="c1"># add panels to subpanel sizer</span>
                <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                    <span class="n">subpanel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

                <span class="c1"># add subpanel sizer to panel sizer, spanning both columns</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">subpanel_sizer</span><span class="p">,</span>
                                    <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_counter</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                    <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                    <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

                <span class="c1"># increment grid counter</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_counter</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="InputPanel.make_ctrls"><a class="viewcode-back" href="../gui.html#StimProgramGUI.InputPanel.make_ctrls">[docs]</a>    <span class="k">def</span> <span class="nf">make_ctrls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">param_info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes controls for create_inputs().</span>

<span class="sd">        :param type:</span>
<span class="sd">        :param tag:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">        :return: proper control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_type</span> <span class="o">=</span> <span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

        <span class="c1"># make control</span>
        <span class="k">if</span> <span class="n">param_type</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">TextCtrlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                               <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
                               <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="s1">&#39;choice&#39;</span><span class="p">:</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">ChoiceCtrlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                 <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">choices</span><span class="o">=</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;choices&#39;</span><span class="p">])</span>

            <span class="c1"># on win32, choice still displays as blank, so manually set</span>
            <span class="c1"># selection to default for aesthetic reasons</span>
            <span class="n">ctrl</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">FilePickerCtrlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
                                     <span class="n">category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tag2&#39;</span><span class="p">]</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">TextCtrlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">size</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">],</span>
                               <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
                               <span class="n">tag2</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                               <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">param_info</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>

            <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>

        <span class="c1"># add control to dict of all controls</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_controls</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># append because duplicates of some controls</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_controls</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_controls</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctrl</span><span class="p">]</span>

        <span class="c1"># bind events to proper methods</span>
        <span class="n">binders</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span>  <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT</span><span class="p">,</span>
                   <span class="s1">&#39;choice&#39;</span><span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHOICE</span><span class="p">,</span>
                   <span class="s1">&#39;path&#39;</span>  <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_FILEPICKER_CHANGED</span><span class="p">,</span>
                   <span class="s1">&#39;list&#39;</span>  <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">binders</span><span class="p">[</span><span class="n">param_type</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_update</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CONTEXT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_right_click</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ctrl</span></div>

<div class="viewcode-block" id="InputPanel.input_update"><a class="viewcode-back" href="../gui.html#StimProgramGUI.InputPanel.input_update">[docs]</a>    <span class="k">def</span> <span class="nf">input_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for updating parameters on changes to input controls</span>

<span class="sd">        :param event: wxPython event, passed by binder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Validate</span><span class="p">()</span>

        <span class="c1"># Get tag of object (which is param name)</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span>

        <span class="c1"># if dir selector, get new path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
        <span class="c1"># else get the new value from the widget</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetString</span><span class="p">()</span>

        <span class="c1"># if choice in grid, leave choice as table and don&#39;t do anything</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">(),</span> <span class="n">ChoiceCtrlTag</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">control_dict</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
                <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># if a list type param, change the appropriate list item by getting</span>
        <span class="c1"># tag2 (list index)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span><span class="o">.</span><span class="n">tag2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                                            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># hide/show panels if necessary</span>
        <span class="k">if</span> <span class="s1">&#39;children&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]:</span>
            <span class="c1"># iterate through all the subpanel and show/hide as needed</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;children&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="c1"># redraw</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

        <span class="c1"># some params need to edit global defaults of StimProgram on the fly</span>
        <span class="c1"># instead of at window instantiation</span>
        <span class="n">global_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_global_params</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;protocol_reps&#39;</span><span class="p">,</span> <span class="s1">&#39;pref_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;capture&#39;</span><span class="p">]:</span>
            <span class="n">StimProgram</span><span class="o">.</span><span class="n">GlobalDefaults</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;trigger_wait&#39;</span><span class="p">:</span>
            <span class="n">StimProgram</span><span class="o">.</span><span class="n">GlobalDefaults</span><span class="p">[</span><span class="s1">&#39;trigger_wait&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="nb">int</span><span class="p">(</span><span class="n">global_params</span><span class="p">[</span><span class="s1">&#39;trigger_wait&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">global_params</span><span class="p">[</span>
                    <span class="s1">&#39;frame_rate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.99</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;background&#39;</span><span class="p">:</span>
            <span class="n">StimProgram</span><span class="o">.</span><span class="n">MyWindow</span><span class="o">.</span><span class="n">change_color</span><span class="p">(</span><span class="n">global_params</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="InputPanel.on_right_click"><a class="viewcode-back" href="../gui.html#StimProgramGUI.InputPanel.on_right_click">[docs]</a>    <span class="k">def</span> <span class="nf">on_right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for passing parameter to table to be added.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ctrl</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">tag</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">tag2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ctrl</span><span class="o">.</span><span class="n">tag2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">add_to_grid</span><span class="p">(</span><span class="n">param</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GlobalPanel"><a class="viewcode-back" href="../gui.html#StimProgramGUI.GlobalPanel">[docs]</a><span class="k">class</span> <span class="nc">GlobalPanel</span><span class="p">(</span><span class="n">InputPanel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass of InputPanel, contains a few aesthetic changes in its init</span>
<span class="sd">    since not part of a notebook.</span>

<span class="sd">    :param params: dictionary of parameters</span>
<span class="sd">    :param parent: parent window of panel (notebook)</span>
<span class="sd">    :param category: category of parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="c1"># super initiation</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GlobalPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>

        <span class="c1"># move items down a few slots to insert spacers and titles</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">GetChildren</span><span class="p">()):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">GetPosTuple</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
            <span class="n">item</span><span class="o">.</span><span class="n">SetPos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="c1"># title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Global Defaults&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># global file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gui_params</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">],</span> <span class="s1">&#39;global_defaults_new.txt&#39;</span><span class="p">))</span>

        <span class="c1"># check if file exists, and if so load different options</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">global_dict</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="n">defaults_list</span> <span class="o">=</span> <span class="n">global_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">defaults_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span> <span class="o">=</span> <span class="n">ChoiceCtrlTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;defaults&#39;</span><span class="p">,</span>
                                           <span class="n">choices</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">defaults_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHOICE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_default_select</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># if global default in ini, select</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gui_params</span><span class="p">[</span><span class="s1">&#39;defaults&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gui_params</span><span class="p">[</span><span class="s1">&#39;defaults&#39;</span><span class="p">])</span>

        <span class="c1"># save button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_default</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_SAVE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_default_save</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_default</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># delete button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_default</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delete&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_default_delete</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_default</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<div class="viewcode-block" id="GlobalPanel.on_default_save"><a class="viewcode-back" href="../gui.html#StimProgramGUI.GlobalPanel.on_default_save">[docs]</a>    <span class="k">def</span> <span class="nf">on_default_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves global default parameters.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># popup dialog to enter save name</span>
        <span class="n">save_name_dialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;save name&#39;</span><span class="p">)</span>

        <span class="c1"># to exit out of popup on cancel</span>
        <span class="k">if</span> <span class="n">save_name_dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># get entered save name</span>
        <span class="n">save_name</span> <span class="o">=</span> <span class="n">save_name_dialog</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="c1"># get params from parameters</span>
        <span class="n">params_to_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_global_params</span><span class="p">()</span>

        <span class="c1"># data folder</span>
        <span class="n">data_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gui_params</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">])</span>

        <span class="c1"># create folder if not present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_folder</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">data_folder</span><span class="p">)</span>

        <span class="c1"># get saved globals if present</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">global_dict</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># leave dict empty otherwise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">global_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># if new save, add to dropdown</span>
        <span class="k">if</span> <span class="n">save_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">global_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">save_name</span><span class="p">)</span>

        <span class="c1"># switch dropdown to save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="n">save_name</span><span class="p">)</span>

        <span class="c1"># add entry to global dict and redump to file</span>
        <span class="n">global_dict</span><span class="p">[</span><span class="n">save_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_to_save</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">global_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlobalPanel.on_default_delete"><a class="viewcode-back" href="../gui.html#StimProgramGUI.GlobalPanel.on_default_delete">[docs]</a>    <span class="k">def</span> <span class="nf">on_default_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes global default parameters.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get which entry is selected</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">GetStringSelection</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">selected</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>

            <span class="c1"># get list of saves from file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">global_dict</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># remove from dict</span>
            <span class="k">del</span> <span class="n">global_dict</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>

            <span class="c1"># redump dict to file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">global_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

            <span class="c1"># add blank spot in control to switch to</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="c1"># delete from control deleted item</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">GetItems</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># delete blank so it can&#39;t be selected. Stays currently selected</span>
            <span class="c1"># though</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">GetItems</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">which_default</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlobalPanel.on_default_select"><a class="viewcode-back" href="../gui.html#StimProgramGUI.GlobalPanel.on_default_select">[docs]</a>    <span class="k">def</span> <span class="nf">on_default_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates global default panel based on saved globals.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetString</span><span class="p">()</span>

        <span class="c1"># get params to load</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globals_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">params_to_load</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="n">selected</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">controls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">all_controls</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># if not a list text control</span>
                    <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;]&#39;</span><span class="p">:</span>
                        <span class="n">control</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">params_to_load</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">control</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">params_to_load</span><span class="p">[</span><span class="n">param</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]][</span><span class="n">index</span><span class="p">])</span>

                <span class="c1"># if not in either dictionary, leave as is</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span></div></div>


<div class="viewcode-block" id="ListPanel"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel">[docs]</a><span class="k">class</span> <span class="nc">ListPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Panel that contains list of stims to run along with add/remove buttons</span>
<span class="sd">    and up/down buttons.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ListPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetTopLevelParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># panel title and its own sizer for proper border spacing</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stims to run&#39;</span><span class="p">)</span>
        <span class="n">title_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">()</span>
        <span class="n">title_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="c1"># sizer for panel</span>
        <span class="n">panel_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="c1"># add title to top of panel sizer</span>
        <span class="n">panel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">title_sizer</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># list control widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ListCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LC_REPORT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span><span class="p">)</span>

        <span class="c1"># add columns to list control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">InsertColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Fill&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">InsertColumn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Shape&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">InsertColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">InsertColumn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Trigger&#39;</span><span class="p">)</span>

        <span class="c1"># add list control to panel sizer</span>
        <span class="n">panel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="c1"># up down buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Move up&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Move down&#39;</span><span class="p">)</span>

        <span class="c1"># sizer for up and down buttons</span>
        <span class="n">up_down_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c1"># add buttons to sizer</span>
        <span class="n">up_down_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">up_button</span><span class="p">,</span>
                          <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                          <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">up_down_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">down_button</span><span class="p">,</span>
                          <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                          <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># add up down sizer to panel sizer</span>
        <span class="n">panel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">up_down_sizer</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_HORIZONTAL</span> <span class="o">|</span>
                             <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># add remove buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ADD</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_REMOVE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Update&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="mi">55</span><span class="p">,</span> <span class="mi">26</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_button</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="mi">55</span><span class="p">,</span> <span class="mi">26</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_button</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="mi">55</span><span class="p">,</span> <span class="mi">26</span><span class="p">))</span>

        <span class="c1"># sizer for add and remove buttons</span>
        <span class="n">add_remove_update_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c1"># add buttons to sizer</span>
        <span class="n">add_remove_update_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">,</span>
                             <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                             <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">add_remove_update_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_button</span><span class="p">,</span>
                             <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                             <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">add_remove_update_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_button</span><span class="p">,</span>
                             <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                             <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># add up down sizer to panel sizer</span>
        <span class="n">panel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">add_remove_update_sizer</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_HORIZONTAL</span> <span class="o">|</span>
                             <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># button binders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_up_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_down_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">down_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_add_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_remove_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_update_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_button</span><span class="p">)</span>

        <span class="c1"># sizer for double click on list item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_LIST_ITEM_ACTIVATED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_double_click</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="p">)</span>

        <span class="c1"># set panel sizer for panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">panel_sizer</span><span class="p">)</span>

<div class="viewcode-block" id="ListPanel.convert_stim_type"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.convert_stim_type">[docs]</a>    <span class="k">def</span> <span class="nf">convert_stim_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stim_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts stim_type label to class names and back</span>

<span class="sd">        :param stim_type: string to be converted</span>
<span class="sd">        :return: converted string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;StaticStim&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;MovingStim&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;RandomlyMovingStim&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;TableStim&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;ImageJumpStim&#39;</span><span class="p">]</span>

        <span class="n">label_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;moving&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;random&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;table&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;jump&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">stim_type</span> <span class="ow">in</span> <span class="n">class_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label_names</span><span class="p">[</span><span class="n">class_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">stim_type</span><span class="p">)]</span>

        <span class="k">elif</span> <span class="n">stim_type</span> <span class="ow">in</span> <span class="n">label_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">class_names</span><span class="p">[</span><span class="n">label_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">stim_type</span><span class="p">)]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Wrong label or stim class&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ListPanel.on_add_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.on_add_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_add_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">insert_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes call to add to list with proper params</span>

<span class="sd">        :param event:</span>
<span class="sd">        :param insert_pos:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_merged_params</span><span class="p">()</span>
        <span class="n">stim_type</span> <span class="o">=</span> <span class="n">param_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;move_type&#39;</span><span class="p">)</span>
        <span class="n">grid_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_grid_dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_list</span><span class="p">(</span><span class="n">stim_type</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">grid_dict</span><span class="p">,</span> <span class="n">insert_pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="ListPanel.add_to_list"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.add_to_list">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stim_type</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">grid_dict</span><span class="p">,</span> <span class="n">insert_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds stim to list of stims to run, as a bew stiminfo class</span>

<span class="sd">        :param stim_type:</span>
<span class="sd">        :param param_dict:</span>
<span class="sd">        :param grid_dict:</span>
<span class="sd">        :param insert_pos: at which position in list to insert stim. Used</span>
<span class="sd">         when moving stims up and down</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">insert_pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">insert_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetItemCount</span><span class="p">()</span>

        <span class="c1"># info for list</span>
        <span class="n">fill</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;fill_mode&#39;</span><span class="p">]</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
        <span class="n">trigger</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;trigger&#39;</span><span class="p">])</span>

        <span class="c1"># add info about stim to list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">InsertStringItem</span><span class="p">(</span><span class="n">insert_pos</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">SetStringItem</span><span class="p">(</span><span class="n">insert_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">SetStringItem</span><span class="p">(</span><span class="n">insert_pos</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">stim_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">SetStringItem</span><span class="p">(</span><span class="n">insert_pos</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">trigger</span><span class="p">)</span>
        <span class="c1"># resize columns to fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">SetColumnWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIST_AUTOSIZE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">SetColumnWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIST_AUTOSIZE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">SetColumnWidth</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIST_AUTOSIZE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">SetColumnWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIST_AUTOSIZE</span><span class="p">)</span>

        <span class="c1"># convert from stim type label to StimProgram instance</span>
        <span class="n">stim_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_stim_type</span><span class="p">(</span><span class="n">stim_type</span><span class="p">)</span>

        <span class="c1"># stim info instance to store and grid control_dict instance to store</span>
        <span class="n">stim_info</span> <span class="o">=</span> <span class="n">StimProgram</span><span class="o">.</span><span class="n">StimInfo</span><span class="p">(</span><span class="n">stim_type</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">insert_pos</span><span class="p">)</span>

        <span class="c1"># add to list of stims to run along with grid info</span>
        <span class="k">if</span> <span class="n">insert_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_pos</span><span class="p">,</span> <span class="n">stim_info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_pos</span><span class="p">,</span> <span class="n">grid_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stim_info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_dict</span><span class="p">)</span>

        <span class="c1"># deselect all in list and select most recently added</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetSelectedItemCount</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetFirstSelected</span><span class="p">(),</span>
                                     <span class="n">on</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">insert_pos</span><span class="p">)</span></div>

        <span class="c1"># print self.stims_to_run_w_grid</span>

<div class="viewcode-block" id="ListPanel.on_remove_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.on_remove_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_remove_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">clear_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes stims from stim list. If none selected, clears all.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if any selected, iterate through and delete</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetSelectedItemCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">clear_all</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetSelectedItemCount</span><span class="p">()):</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetFirstSelected</span><span class="p">()</span>
                <span class="c1"># remove from stims to run</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
                <span class="c1"># remove from list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">DeleteItem</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>

            <span class="c1"># reset stim numbers in stims to run</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">):</span>
                <span class="n">stim</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">DeleteAllItems</span><span class="p">()</span>
            <span class="c1"># clear stims to run</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[:]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="ListPanel.on_update_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.on_update_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_update_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes stims and adds stim to list, in essence updating/refreshing</span>
<span class="sd">        the currently selected stim.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if any selected, iterate through and delete</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetSelectedItemCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetFirstSelected</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_remove_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_add_button</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ListPanel.on_up_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.on_up_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_up_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves a stim up in the list by removing it and reinserting it into</span>
<span class="sd">        proper position.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># only move if only 1 stim selected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetSelectedItemCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetFirstSelected</span><span class="p">()</span>
            <span class="c1"># don&#39;t move up if already at top</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># get params</span>
                <span class="n">stim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">stim_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_stim_type</span><span class="p">(</span><span class="n">stim</span><span class="o">.</span><span class="n">stim_type</span><span class="p">)</span>
                <span class="n">param_dict</span> <span class="o">=</span> <span class="n">stim</span><span class="o">.</span><span class="n">parameters</span>

                <span class="c1"># get grid dict</span>
                <span class="n">grid_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

                <span class="c1"># remove</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_remove_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

                <span class="c1"># re-add</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_to_list</span><span class="p">(</span><span class="n">stim_type</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">grid_dict</span><span class="p">,</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># reset stim numbers in stims to run</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">):</span>
                    <span class="n">stim</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">i</span></div>

<div class="viewcode-block" id="ListPanel.on_down_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.on_down_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_down_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves a stim down in the list by removing it and reinserting it into</span>
<span class="sd">        proper position.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># only move if only 1 stim selected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetSelectedItemCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetFirstSelected</span><span class="p">()</span>
            <span class="c1"># don&#39;t move up if already at bottom</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetItemCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># get params</span>
                <span class="n">stim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">stim_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_stim_type</span><span class="p">(</span><span class="n">stim</span><span class="o">.</span><span class="n">stim_type</span><span class="p">)</span>
                <span class="n">param_dict</span> <span class="o">=</span> <span class="n">stim</span><span class="o">.</span><span class="n">parameters</span>

                <span class="c1"># get grid dict</span>
                <span class="n">grid_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

                <span class="c1"># remove</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_remove_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

                <span class="c1"># readd</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_to_list</span><span class="p">(</span><span class="n">stim_type</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">grid_dict</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># reset stim numbers in stims to run</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">):</span>
                    <span class="n">stim</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">i</span></div>

<div class="viewcode-block" id="ListPanel.on_double_click"><a class="viewcode-back" href="../gui.html#StimProgramGUI.ListPanel.on_double_click">[docs]</a>    <span class="k">def</span> <span class="nf">on_double_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads params from list and for grid on double click</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_control</span><span class="o">.</span><span class="n">GetFirstSelected</span><span class="p">()</span>
        <span class="n">stim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
        <span class="n">grid_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
        <span class="c1"># copy so adding move type doesn&#39;t affect StimInfo instance</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">stim</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">stim_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_stim_type</span><span class="p">(</span><span class="n">stim</span><span class="o">.</span><span class="n">stim_type</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;move_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stim_type</span>

        <span class="c1"># compatibility for old checkerboards</span>
        <span class="k">if</span> <span class="s1">&#39;check_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fill_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fill_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checkerboard&#39;</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;check_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span>
            <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fill_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;checkerboard&#39;</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;check_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checkerboard&#39;</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">grid</span>

        <span class="c1"># post events to grid to simulate removing columns to clear text and</span>
        <span class="c1"># make controls editable again</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()):</span>
            <span class="n">evt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GridEvent</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">wxEVT_GRID_LABEL_RIGHT_CLICK</span><span class="p">,</span>
                                    <span class="n">grid</span><span class="p">,</span>
                                    <span class="n">row</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">GetEventHandler</span><span class="p">()</span><span class="o">.</span><span class="n">ProcessEvent</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

        <span class="c1"># iterate through params and set values</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">controls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">all_controls</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># if not a list text control</span>
                    <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;]&#39;</span><span class="p">:</span>
                        <span class="n">control</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">control</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]][</span><span class="n">index</span><span class="p">])</span>

                <span class="c1"># if not in either dictionary, leave as is</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="c1"># iterate through values in grid dict and populate</span>
        <span class="n">col_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">grid_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1"># simulate adding param to grid</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">all_controls</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">evt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CommandEvent</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CONTEXT_MENU</span><span class="o">.</span><span class="n">typeId</span><span class="p">,</span>
                                  <span class="n">ctrl</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">SetEventObject</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
            <span class="n">ctrl</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetEventHandler</span><span class="p">()</span><span class="o">.</span><span class="n">ProcessEvent</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

            <span class="c1"># iterate through values and populate column and grid control_dict</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetCellValue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="c1"># if out of rows, add more</span>
                    <span class="k">except</span> <span class="n">wx</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">PyAssertionError</span><span class="p">:</span>
                        <span class="c1"># send add more rows event</span>
                        <span class="n">evt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GridEvent</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span>
                                                <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">wxEVT_GRID_LABEL_RIGHT_CLICK</span><span class="p">,</span>
                                                <span class="n">grid</span><span class="p">,</span>
                                                <span class="n">row</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="n">col</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">GetEventHandler</span><span class="p">()</span><span class="o">.</span><span class="n">ProcessEvent</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
                        <span class="c1"># retry adding</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetCellValue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">col_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Stim params populated&#39;</span></div></div>


<div class="viewcode-block" id="DirPanel"><a class="viewcode-back" href="../gui.html#StimProgramGUI.DirPanel">[docs]</a><span class="k">class</span> <span class="nc">DirPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for file browser panel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param parent:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># super instantiation</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DirPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetTopLevelParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># sizer for panel</span>
        <span class="n">panel_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="c1"># file browser</span>
        <span class="n">default_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gui_params</span><span class="p">[</span><span class="s1">&#39;saved_stim_dir&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">wildCard</span><span class="o">=</span><span class="s1">&#39;*.txt&#39;</span><span class="p">,</span>
                                   <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                   <span class="n">defaultDirectory</span><span class="o">=</span><span class="n">default_dir</span><span class="p">)</span>

        <span class="c1"># add browser to panel</span>
        <span class="n">panel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="c1"># make buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_SAVE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Load&#39;</span><span class="p">)</span>

        <span class="c1"># button sizer</span>
        <span class="n">button_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c1"># add buttons to sizer</span>
        <span class="n">button_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_button</span><span class="p">,</span>
                         <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                         <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">button_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_button</span><span class="p">,</span>
                         <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                         <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># add button sizer to panel sizer</span>
        <span class="n">panel_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">button_sizer</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span>
                             <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_HORIZONTAL</span> <span class="o">|</span>
                             <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>

        <span class="c1"># event binders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_save_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_load_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_FILECTRL_FILEACTIVATED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_double_click</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="p">)</span>

        <span class="c1"># set sizer to panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">panel_sizer</span><span class="p">)</span>

<div class="viewcode-block" id="DirPanel.on_save_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.DirPanel.on_save_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_save_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves current list of stims to text file.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;./psychopy/stims/&#39;</span><span class="p">)</span>

        <span class="c1"># popup save dialog</span>
        <span class="n">save_dialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;File path&#39;</span><span class="p">,</span>
                                    <span class="n">defaultDir</span><span class="o">=</span><span class="n">default_dir</span><span class="p">,</span>
                                    <span class="n">wildcard</span><span class="o">=</span><span class="s1">&#39;*.txt&#39;</span><span class="p">,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="p">)</span>

        <span class="c1"># to exit out of popup on cancel button</span>
        <span class="k">if</span> <span class="n">save_dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># get list of stims that need to be saved</span>
        <span class="n">to_save</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stims</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">stim</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
            <span class="c1"># add move type back in to parameters</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;move_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stim</span><span class="o">.</span><span class="n">stim_type</span>
            <span class="c1"># add grid dict in to parameters</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;grid_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># add to save list</span>
            <span class="n">to_save</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># get path from save dialog</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">save_dialog</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

        <span class="c1"># open text file in binary mode to dump</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">to_save</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="c1"># refresh file browser to show new saved file</span>
        <span class="c1"># ugly way of doing this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">ShowHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">ShowHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirPanel.on_load_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.DirPanel.on_load_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_load_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads stims from text file.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get path from browser</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

        <span class="n">is_log</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span> <span class="ow">in</span> <span class="n">path</span>

        <span class="c1"># if not log file, open and load pickle data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_log</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">to_load</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No file selected. Please select file.&#39;</span>
                <span class="k">return</span>

        <span class="c1"># if log file, need to seek to end to find the pickle data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># iterate through lines to look for pickle header</span>
                    <span class="n">next_is_pickle</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">to_load</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">next_is_pickle</span><span class="p">:</span>
                            <span class="n">to_load</span> <span class="o">+=</span> <span class="n">line</span>

                        <span class="c1"># need to strip newline character</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;#BEGIN PICKLE#&#39;</span><span class="p">:</span>
                            <span class="n">next_is_pickle</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">to_load</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">to_load</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ERROR: file not a properly formatted parameter file&#39;</span>
                <span class="k">return</span>

        <span class="c1"># load stims in to list panel</span>
        <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">to_load</span><span class="p">:</span>
            <span class="c1"># take back out move type</span>
            <span class="n">stim_type</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;move_type&#39;</span><span class="p">)</span>
            <span class="c1"># take back out grid dict</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">grid_dict</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;grid_dict&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">grid_dict</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;control_list&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">grid_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># compatibility for old checkerboards</span>
            <span class="k">if</span> <span class="s1">&#39;check_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fill_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fill_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checkerboard&#39;</span>
                    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;check_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span>
                <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fill_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;checkerboard&#39;</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;check_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checkerboard&#39;</span>

            <span class="c1"># convert from StimProgram instance label to stim type</span>
            <span class="n">stim_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">convert_stim_type</span><span class="p">(</span><span class="n">stim_type</span><span class="p">)</span>

            <span class="c1"># load</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">add_to_list</span><span class="p">(</span><span class="n">stim_type</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">grid_dict</span><span class="p">)</span>

        <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Stim(s) loaded&#39;</span></div>

<div class="viewcode-block" id="DirPanel.on_double_click"><a class="viewcode-back" href="../gui.html#StimProgramGUI.DirPanel.on_double_click">[docs]</a>    <span class="k">def</span> <span class="nf">on_double_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If log file, opens, else loads.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

        <span class="n">is_log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span>\
            <span class="s1">&#39;logs&#39;</span>

        <span class="k">if</span> <span class="n">is_log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;open &#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">GetMouseState</span><span class="p">()</span><span class="o">.</span><span class="n">ControlDown</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_load_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">on_remove_button</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">clear_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_load_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MyParamGrid"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyParamGrid">[docs]</a><span class="k">class</span> <span class="nc">MyParamGrid</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for grid of all params to override stim params.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>

<span class="sd">        :param parent:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># call to super</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyParamGrid</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Parameter override&#39;</span><span class="p">)</span>

        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_shown</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># panel to hold everything</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># make grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">CreateGrid</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetColLabelValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Parameter&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetColLabelValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Value&#39;</span><span class="p">)</span>

        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shape parameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">shape_param</span><span class="p">,</span>
                      <span class="s1">&#39;timing parameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timing_param</span><span class="p">,</span>
                      <span class="s1">&#39;fill parameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fill_param</span><span class="p">,</span>
                      <span class="s1">&#39;motion parameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">motion_param</span><span class="p">}</span>

        <span class="n">row_ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">param_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetCellValue</span><span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetReadOnly</span><span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">row_ind</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetCellValue</span><span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetReadOnly</span><span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">row_ind</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># sizer for grid</span>
        <span class="n">grid_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="c1"># set sizer</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">grid_sizer</span><span class="p">)</span>

        <span class="c1"># catch close to only hide grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_close_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">EVT_GRID_CELL_RIGHT_CLICK</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">on_grid_cell_right_click</span><span class="p">)</span>

<div class="viewcode-block" id="MyParamGrid.show_grid"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyParamGrid.show_grid">[docs]</a>    <span class="k">def</span> <span class="nf">show_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to show grid. Unminimizes and brings to front.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Iconize</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_shown</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MyParamGrid.hide_grid"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyParamGrid.hide_grid">[docs]</a>    <span class="k">def</span> <span class="nf">hide_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to hide grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_shown</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MyParamGrid.on_close_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyParamGrid.on_close_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_close_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Catches close in order to only hide. Otherwise frame object is</span>
<span class="sd">        deleted and loses all data.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">menu_bar</span><span class="o">.</span><span class="n">options_override</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyParamGrid.on_grid_cell_right_click"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyParamGrid.on_grid_cell_right_click">[docs]</a>    <span class="k">def</span> <span class="nf">on_grid_cell_right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes contents of cell.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetRow</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetCol</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetCellValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyParamGrid.get_grid_dict"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyParamGrid.get_grid_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a dict of rows with entered values, ignoring headers</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">()):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetCellValue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetCellValue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Parameters</span><span class="o">.</span><span class="n">lit_eval</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span></div></div>


<div class="viewcode-block" id="MyGrid"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid">[docs]</a><span class="k">class</span> <span class="nc">MyGrid</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for grid window.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param parent:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># necessary call to super</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyGrid</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>

        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_shown</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># panel to hold everything</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># instantiate grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">CreateGrid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># sizer for grid</span>
        <span class="n">grid_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">grid_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="c1"># set sizer</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">grid_sizer</span><span class="p">)</span>

        <span class="c1"># bind grid events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">EVT_GRID_LABEL_RIGHT_CLICK</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">on_grid_label_right_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">EVT_GRID_CELL_RIGHT_CLICK</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">on_grid_cell_right_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">EVT_GRID_CELL_CHANGED</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">on_grid_cell_changed</span><span class="p">)</span>

        <span class="c1"># catch close to only hide grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_close_button</span><span class="p">)</span>

<div class="viewcode-block" id="MyGrid.show_grid"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.show_grid">[docs]</a>    <span class="k">def</span> <span class="nf">show_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to show grid. Unminimizes and brings to front.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Iconize</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_shown</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MyGrid.hide_grid"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.hide_grid">[docs]</a>    <span class="k">def</span> <span class="nf">hide_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to hide grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_shown</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MyGrid.on_close_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.on_close_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_close_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Catches close in order to only hide. Otherwise frame object is</span>
<span class="sd">        deleted and loses all data.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_grid</span><span class="p">()</span></div>

<div class="viewcode-block" id="MyGrid.add_to_grid"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.add_to_grid">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds column to table and prevents editing of control.</span>

<span class="sd">        :param param:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ctrls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">all_controls</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span> <span class="ow">and</span> <span class="n">ctrls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">category</span> \
                <span class="o">!=</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
            <span class="c1"># add column to grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ClearSelection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">AppendCols</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetGridCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetColLabelValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

            <span class="c1"># get value of control</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_param_value</span><span class="p">(</span>
                    <span class="n">ctrls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_param_value</span><span class="p">(</span>
                    <span class="n">ctrls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">param</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="p">)</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># if no other rows, add some, and populate control dict</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">NumberCols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">AppendRows</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">for</span> <span class="n">ctrl</span> <span class="ow">in</span> <span class="n">ctrls</span><span class="p">:</span>
                <span class="n">ctrl</span><span class="o">.</span><span class="n">set_editable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetCellValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># if already in grid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ClearSelection</span><span class="p">()</span>

            <span class="c1"># highlight column</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">param</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SelectCol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetGridCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_grid</span><span class="p">()</span></div>

<div class="viewcode-block" id="MyGrid.on_grid_cell_changed"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.on_grid_cell_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_grid_cell_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates control dict when values in cells are changed.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetRow</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetCol</span><span class="p">()</span>
        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetCellValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># if in last row, add more rows</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">evt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GridEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">wxEVT_GRID_LABEL_RIGHT_CLICK</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="p">,</span>
                                    <span class="n">row</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">col</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GetEventHandler</span><span class="p">()</span><span class="o">.</span><span class="n">ProcessEvent</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">MoveCursorDown</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyGrid.on_grid_label_right_click"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.on_grid_label_right_click">[docs]</a>    <span class="k">def</span> <span class="nf">on_grid_label_right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds more rows if top left corner right clicked. Deletes row/column if</span>
<span class="sd">        row/column header right clicked.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetRow</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetCol</span><span class="p">()</span>

        <span class="c1"># column headers</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># leftmost column</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">AppendRows</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="c1"># add to control dict lists</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                        <span class="n">value</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>

            <span class="c1"># any other column header</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># make control editable and set value</span>
                <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ctrl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">all_controls</span><span class="p">[</span><span class="n">param</span><span class="p">]:</span>
                    <span class="n">ctrl</span><span class="o">.</span><span class="n">set_editable</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">old_value</span><span class="p">)</span>

                <span class="c1"># remove column and from control dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">DeleteCols</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>

                <span class="c1"># if no more columns, delete rows</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">DeleteRows</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numRows</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>

        <span class="c1"># row headers</span>
        <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">value</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">DeleteRows</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyGrid.on_grid_cell_right_click"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.on_grid_cell_right_click">[docs]</a>    <span class="k">def</span> <span class="nf">on_grid_cell_right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes contents of cell.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetRow</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetCol</span><span class="p">()</span>

        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">SetCellValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MyGrid.get_grid_dict"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyGrid.get_grid_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter. Sets middle Nones to previous values.</span>

<span class="sd">        :return: edited dictionary of params and values in grid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">to_edit</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_dict</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">to_edit</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;First value of table cannot be empty.&#39;</span><span class="p">)</span>

            <span class="c1"># get number of terminal Nones</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">where_stop</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>

            <span class="c1"># iterate until terminal nones</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">where_stop</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">values</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">lit_eval</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

        <span class="k">return</span> <span class="n">ret</span></div></div>


<div class="viewcode-block" id="MyMenuBar"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar">[docs]</a><span class="k">class</span> <span class="nc">MyMenuBar</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for custom menu bar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyMenuBar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="c1"># menus</span>
        <span class="n">file_menu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">view_menu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">options_menu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>

        <span class="c1"># file menus</span>
        <span class="n">file_quit</span> <span class="o">=</span> <span class="n">file_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_EXIT</span><span class="p">,</span> <span class="s1">&#39;Quit&#39;</span><span class="p">,</span> <span class="s1">&#39;Quit application&#39;</span><span class="p">)</span>

        <span class="c1"># view menus</span>
        <span class="n">view_logs</span> <span class="o">=</span> <span class="n">view_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;Open log folder&#39;</span><span class="p">)</span>
        <span class="n">view_stims</span> <span class="o">=</span> <span class="n">view_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;stims&#39;</span><span class="p">,</span> <span class="s1">&#39;Open stim folder&#39;</span><span class="p">)</span>

        <span class="c1"># options menus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_log</span> <span class="o">=</span> <span class="n">options_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;Save runs to log file&#39;</span><span class="p">,</span>
                                               <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_CHECK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_log</span><span class="o">.</span><span class="n">Toggle</span><span class="p">()</span>  <span class="c1"># default to True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_capture</span> <span class="o">=</span> <span class="n">options_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;capture&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;Capture run and create &#39;</span>
                                                   <span class="s1">&#39;video&#39;</span><span class="p">,</span>
                                                   <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_CHECK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_mirror</span> <span class="o">=</span> <span class="n">options_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;mirror&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;Make small mirror window&#39;</span><span class="p">,</span>
                                                   <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_CHECK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_override</span> <span class="o">=</span> <span class="n">options_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;global override&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;Override parameters&#39;</span><span class="p">,</span>
                                                    <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_CHECK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_framepack</span> <span class="o">=</span> <span class="n">options_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;framepack&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;Split RGB frames into monochrome triplets&#39;</span><span class="p">,</span>
                                                    <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_CHECK</span><span class="p">)</span>

        <span class="c1"># options submenu</span>
        <span class="n">options_tools</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">tools_rec_map</span> <span class="o">=</span> <span class="n">options_tools</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                                             <span class="s1">&#39;Map receptive field&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;Generate receptive field map&#39;</span><span class="p">)</span>
        <span class="n">options_menu</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;tools&#39;</span><span class="p">,</span> <span class="n">options_tools</span><span class="p">)</span>

        <span class="c1"># add top level menus to menu bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">file_menu</span><span class="p">,</span> <span class="s1">&#39;&amp;File&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">view_menu</span><span class="p">,</span> <span class="s1">&#39;&amp;View&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">options_menu</span><span class="p">,</span> <span class="s1">&#39;&amp;Options&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_file_quit</span><span class="p">,</span> <span class="n">file_quit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_view_logs</span><span class="p">,</span> <span class="n">view_logs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_view_stims</span><span class="p">,</span> <span class="n">view_stims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_options_log</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_options_capture</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_capture</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_options_mirror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_mirror</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_options_override</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_override</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_options_framepack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_framepack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_options_tools_rec_map</span><span class="p">,</span> <span class="n">tools_rec_map</span><span class="p">)</span>

<div class="viewcode-block" id="MyMenuBar.on_file_quit"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_file_quit">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles quitting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span></div>

<div class="viewcode-block" id="MyMenuBar.on_view_logs"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_view_logs">[docs]</a>    <span class="k">def</span> <span class="nf">on_view_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles request to view logs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">stim_params</span><span class="p">[</span><span class="s1">&#39;logs_dir&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">logs_dir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">logs_dir</span><span class="p">])</span></div>

<div class="viewcode-block" id="MyMenuBar.on_view_stims"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_view_stims">[docs]</a>    <span class="k">def</span> <span class="nf">on_view_stims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles request to view stims</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stim_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gui_params</span><span class="p">[</span><span class="s1">&#39;saved_stim_dir&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">stim_dir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">stim_dir</span><span class="p">])</span></div>

<div class="viewcode-block" id="MyMenuBar.on_options_log"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_options_log">[docs]</a>    <span class="k">def</span> <span class="nf">on_options_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles toggling logging</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_log</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="n">StimProgram</span><span class="o">.</span><span class="n">GlobalDefaults</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="MyMenuBar.on_options_capture"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_options_capture">[docs]</a>    <span class="k">def</span> <span class="nf">on_options_capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles toggling capturing</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_capture</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;capture&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="n">StimProgram</span><span class="o">.</span><span class="n">GlobalDefaults</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="MyMenuBar.on_options_mirror"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_options_mirror">[docs]</a>    <span class="k">def</span> <span class="nf">on_options_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles toggling capturing</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_mirror</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;small_win&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="n">StimProgram</span><span class="o">.</span><span class="n">GlobalDefaults</span><span class="p">[</span><span class="s1">&#39;small_win&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="MyMenuBar.on_options_override"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_options_override">[docs]</a>    <span class="k">def</span> <span class="nf">on_options_override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles toggling to bring up grid of all params</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_override</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">param_grid</span><span class="o">.</span><span class="n">show_grid</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">param_grid</span><span class="o">.</span><span class="n">hide_grid</span><span class="p">()</span></div>

<div class="viewcode-block" id="MyMenuBar.on_options_framepack"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_options_framepack">[docs]</a>    <span class="k">def</span> <span class="nf">on_options_framepack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles toggling capturing</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_framepack</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">()</span>

        <span class="c1"># self.frame.parameters.set_param_value(&#39;global&#39;, &#39;framepack&#39;, val)</span>
        <span class="n">StimProgram</span><span class="o">.</span><span class="n">GlobalDefaults</span><span class="p">[</span><span class="s1">&#39;framepack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="MyMenuBar.on_options_tools_rec_map"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.on_options_tools_rec_map">[docs]</a>    <span class="k">def</span> <span class="nf">on_options_tools_rec_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles request to map receptive field_rect</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># start dialog to select folders</span>
        <span class="n">log_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">stim_params</span><span class="p">[</span><span class="s1">&#39;logs_dir&#39;</span><span class="p">])</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;Select folder(s) with desired JumpStim logs&#39;</span>
        <span class="n">folder_select_dialog</span> <span class="o">=</span> <span class="n">mdd</span><span class="o">.</span><span class="n">MultiDirDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                                  <span class="n">message</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
                                                  <span class="n">defaultPath</span><span class="o">=</span><span class="n">log_dir</span><span class="p">,</span>
                                                  <span class="n">agwStyle</span><span class="o">=</span><span class="n">mdd</span><span class="o">.</span><span class="n">DD_MULTIPLE</span><span class="p">)</span>

        <span class="c1"># to exit out of dialog on cancel</span>
        <span class="k">if</span> <span class="n">folder_select_dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">jump_paths</span> <span class="o">=</span> <span class="n">folder_select_dialog</span><span class="o">.</span><span class="n">GetPaths</span><span class="p">()</span>

        <span class="c1"># GetPaths of MultiDirDialog prepends volume information to paths,</span>
        <span class="c1"># so need to strip out, platform dependant</span>
        <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="n">jump_paths</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">jump_paths</span><span class="p">)</span>
            <span class="n">jump_paths</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">,</span> <span class="n">jump_paths</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
            <span class="n">jump_paths</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Macintosh HD&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                             <span class="n">jump_paths</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">jump</span> <span class="ow">in</span> <span class="n">jump_paths</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">One or more of the selected paths do not exist:&#39;</span>
            <span class="k">for</span> <span class="n">jump</span> <span class="ow">in</span> <span class="n">jump_paths</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;    </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;Select heka wave file&#39;</span>

        <span class="n">wave_dialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                    <span class="n">message</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
                                    <span class="c1"># defaultDir=default_dir,</span>
                                    <span class="n">wildcard</span><span class="o">=</span><span class="s1">&#39;*.dat&#39;</span><span class="p">,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_FILE_MUST_EXIST</span><span class="p">)</span>

        <span class="c1"># to exit out of dialog on cancel button</span>
        <span class="k">if</span> <span class="n">wave_dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">wave_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">wave_dialog</span><span class="o">.</span><span class="n">GetPath</span><span class="p">())</span>

        <span class="n">wave_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt_wave_details</span><span class="p">()</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dat_file</span><span class="o">=</span><span class="n">wave_path</span><span class="p">,</span>
                      <span class="n">jump_logs</span><span class="o">=</span><span class="n">jump_paths</span><span class="p">,</span>
                      <span class="n">group</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]),</span>
                      <span class="n">series</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;series&#39;</span><span class="p">]),</span>
                      <span class="n">sweep</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;sweep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
                          <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)),</span>
                      <span class="n">data_trace</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;data_trace&#39;</span><span class="p">]),</span>
                      <span class="n">trigger_trace</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;trigger_trace&#39;</span><span class="p">]),</span>
                      <span class="n">thresh</span><span class="o">=</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;thresh&#39;</span><span class="p">],</span>
                      <span class="n">center_on</span><span class="o">=</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;center_on&#39;</span><span class="p">],</span>
                      <span class="n">window</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]),</span>
                      <span class="n">latency</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;latency&#39;</span><span class="p">]),</span>
                      <span class="n">num_frames</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">wave_details</span><span class="p">[</span><span class="s1">&#39;num_frames&#39;</span><span class="p">])</span>
                      <span class="p">)</span>

        <span class="c1"># for k, v in kwargs.iteritems():</span>
        <span class="c1">#     print k, v</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">heka_reader</span> <span class="k">import</span> <span class="n">process_data</span>
            <span class="n">rec_field</span> <span class="o">=</span> <span class="n">process_data</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="nb">print</span> <span class="s1">&#39;Something went wrong: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">rec_field</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rec_field</span><span class="p">)</span>
        <span class="n">rec_field</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># default_dir = os.path.abspath(&#39;./psychopy/stims/&#39;)</span>

        <span class="c1"># popup save dialog</span>
        <span class="n">save_dialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Save receptive field map?&#39;</span><span class="p">,</span>
                                    <span class="n">wildcard</span><span class="o">=</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span>
                                    <span class="c1"># defaultDir=default_dir,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="p">)</span>

        <span class="c1"># to exit out of popup on cancel button</span>
        <span class="k">if</span> <span class="n">save_dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">save_dialog</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
        <span class="nb">print</span> <span class="n">path</span>

        <span class="n">rec_field</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MyMenuBar.prompt_wave_details"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyMenuBar.prompt_wave_details">[docs]</a>    <span class="k">def</span> <span class="nf">prompt_wave_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog to prompt for details about the heka file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;series&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;series&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;sweep&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;sweeps (csv)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;data_trace&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;data trace&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;trigger_trace&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;trigger trace&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;thresh&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;center_on&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span> <span class="p">:</span> <span class="s1">&#39;center on (min, max)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;window&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;spike width (ms)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;0.75&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;latency&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;latency (ms)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;10&#39;</span><span class="p">}</span>
             <span class="p">),</span>

            <span class="p">(</span><span class="s1">&#39;num_frames&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;prev. frames to avg&#39;</span><span class="p">,</span>
              <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">}</span>
             <span class="p">),</span>
            <span class="p">])</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Wave details&#39;</span><span class="p">)</span>

        <span class="c1"># inputs sizer</span>
        <span class="n">inputs_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vgap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                        <span class="n">hgap</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">TextCtrlTag</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span>
                               <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                               <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
                               <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>

            <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>

            <span class="n">inputs_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">inputs_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>

        <span class="n">dlg_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">dlg_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">inputs_sizer</span><span class="p">,</span>
                      <span class="n">proportion</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
                      <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">button_sizer</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">CreateSeparatedButtonSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="n">dlg_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">button_sizer</span><span class="p">,</span>
                      <span class="n">proportion</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span>
                      <span class="n">border</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">dlg</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">dlg_sizer</span><span class="p">)</span>
        <span class="n">dlg_sizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

        <span class="c1"># to exit out of dialog on cancel button</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ret</span></div></div>


<div class="viewcode-block" id="MyStatusBar"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyStatusBar">[docs]</a><span class="k">class</span> <span class="nc">MyStatusBar</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StatusBar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for custom status bar to color background on errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyStatusBar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetFieldsCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_box</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; hello&#39;</span><span class="p">)</span>

        <span class="c1"># size is weird on win32, so adjust for aesthetics</span>
        <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="n">field_rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFieldRect</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">field_rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_box</span><span class="o">.</span><span class="n">SetRect</span><span class="p">(</span><span class="n">field_rect</span><span class="p">)</span>

<div class="viewcode-block" id="MyStatusBar.set_status_text"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyStatusBar.set_status_text">[docs]</a>    <span class="k">def</span> <span class="nf">set_status_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_box</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyStatusBar.set_background"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyStatusBar.set_background">[docs]</a>    <span class="k">def</span> <span class="nf">set_background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_box</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">color</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyStatusBar.set_text_color"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyStatusBar.set_text_color">[docs]</a>    <span class="k">def</span> <span class="nf">set_text_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_box</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="n">color</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MyFrame"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyFrame">[docs]</a><span class="k">class</span> <span class="nc">MyFrame</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for generating frame. Instantiates parameters, notebook, and panels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor. Creates and lays out panels in sizers, finally hiding</span>
<span class="sd">        unnecessary subpanels.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># super initiation</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Stimulus Program&quot;</span><span class="p">)</span>

        <span class="c1"># instantiate parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">gui_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stim_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">stim_params</span>

        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_open</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_controls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_break</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># make grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">MyGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">MyParamGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># notebook to hold input panels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_nb</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Notebook</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># instantiate panels with notebook as parent</span>
        <span class="n">notebook_info</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">shape_param</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timing_param</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">fill_param</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">motion_param</span><span class="p">],</span>
                         <span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="s1">&#39;timing&#39;</span><span class="p">,</span> <span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;motion&#39;</span><span class="p">]]</span>

        <span class="n">pages</span> <span class="o">=</span> <span class="p">[</span><span class="n">InputPanel</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_nb</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">params</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span>
                 <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">notebook_info</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">page</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Shape&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Fill&#39;</span><span class="p">,</span> <span class="s1">&#39;Motion&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_nb</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># instantiate global panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel_global</span> <span class="o">=</span> <span class="n">GlobalPanel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_default_param</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">)</span>

        <span class="c1"># sizer to hold notebook and global panel</span>
        <span class="n">panel_row</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c1"># add notebook panel and global panel to sizer</span>
        <span class="n">panel_row</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_nb</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">panel_row</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel_global</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="c1"># create buttons</span>
        <span class="n">button_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Run&#39;</span><span class="p">,</span> <span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="s1">&#39;Window&#39;</span><span class="p">,</span> <span class="s1">&#39;Exit&#39;</span><span class="p">]</span>
        <span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">button_labels</span><span class="p">]</span>

        <span class="n">button_callback</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">on_run_button</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">on_stop_button</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">on_win_button</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">on_exit_button</span><span class="p">]</span>

        <span class="c1"># sizer for buttons under panel_row</span>
        <span class="n">stim_buttons_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c1"># set binders and add to sizer</span>
        <span class="k">for</span> <span class="n">button</span><span class="p">,</span> <span class="n">button_func</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">buttons</span><span class="p">,</span> <span class="n">button_callback</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="n">button_func</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
            <span class="n">stim_buttons_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">button</span><span class="p">,</span>
                                   <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                   <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span>

        <span class="c1"># sizer for input and global panels and buttons</span>
        <span class="n">panel_button_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="c1"># add buttons and panels</span>
        <span class="n">panel_button_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">panel_row</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">panel_button_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">stim_buttons_sizer</span><span class="p">,</span>
                               <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                               <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_HORIZONTAL</span> <span class="o">|</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>

        <span class="c1"># instantiate list and dir panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span> <span class="o">=</span> <span class="n">ListPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_panel</span> <span class="o">=</span> <span class="n">DirPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># frame sizer to hold panel button sizer and list panel</span>
        <span class="n">frame_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c1"># add list and dir panel and panel button sizer to frame sizer</span>
        <span class="n">frame_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_panel</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">frame_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">frame_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">panel_button_sizer</span><span class="p">)</span>

        <span class="c1"># status bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span> <span class="o">=</span> <span class="n">MyStatusBar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetStatusBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="p">)</span>

        <span class="c1"># menu bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar</span> <span class="o">=</span> <span class="n">MyMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menu_bar</span><span class="p">)</span>

        <span class="c1"># hide all subpanels</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_nb</span><span class="o">.</span><span class="n">GetChildren</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">panel</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">subpanel</span> <span class="ow">in</span> <span class="n">panel</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                    <span class="n">panel</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">subpanel</span><span class="p">]</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>

        <span class="c1"># set sizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">frame_sizer</span><span class="p">)</span>
        <span class="n">frame_sizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># show/hide appropriate subpanels</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_nb</span><span class="o">.</span><span class="n">GetChildren</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">panel</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">subpanel</span> <span class="ow">in</span> <span class="n">panel</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">subpanel</span> <span class="o">!=</span> <span class="n">panel</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]:</span>
                        <span class="n">panel</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">subpanel</span><span class="p">]</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">panel</span><span class="o">.</span><span class="n">sub_panel_dict</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">subpanel</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
                        <span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>

        <span class="c1"># change background color to match panels on win32</span>
        <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NullColour</span><span class="p">)</span>

        <span class="c1"># location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_params</span><span class="p">[</span><span class="s1">&#39;window_pos&#39;</span><span class="p">])</span>

        <span class="c1"># draw frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

<div class="viewcode-block" id="MyFrame.on_run_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyFrame.on_run_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_run_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for calling run and changing values from grid if necessary.</span>

<span class="sd">        :param event:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_open</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_stop_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">do_break</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># get length of longest list in grid</span>
                <span class="n">grid_max</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">stim</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">stim</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">stim</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                            <span class="n">length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
                            <span class="n">grid_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">grid_max</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">grid_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># run through grid</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_max</span><span class="p">):</span>

                        <span class="c1"># for each stim to be run</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">stim</span> <span class="ow">in</span> \
                                <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run_w_grid</span><span class="p">):</span>

                            <span class="c1"># for each grid dict</span>
                            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">stim</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>

                                <span class="c1"># set values</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="c1"># list types</span>
                                        <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;]&#39;</span><span class="p">:</span>
                                            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                                            <span class="n">fixed_param</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

                                            <span class="c1"># change parameter</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[</span>
                                                <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span>
                                                <span class="n">fixed_param</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                                        <span class="c1"># convert to instances</span>
                                        <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;move_type&#39;</span><span class="p">:</span>
                                            <span class="n">value</span> <span class="o">=</span> \
                                                <span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span>\
                                                <span class="n">convert_stim_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                                            <span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[</span>
                                                <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">stim_type</span> <span class="o">=</span> <span class="n">value</span>

                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">[</span>
                                                <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                                    <span class="c1"># if reach end of some lists</span>
                                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                        <span class="k">pass</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_break</span><span class="p">:</span>
                            <span class="k">break</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_win_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_run_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Please add stims.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s1">&#39;Please add stims.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MyFrame.run"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyFrame.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for running stims. Makes changes based on param grid if necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># try/except, so that uncaught errors thrown by StimProgram can be</span>
        <span class="c1"># caught to avoid hanging.</span>
        <span class="n">to_run</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_panel</span><span class="o">.</span><span class="n">stims_to_run</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="o">.</span><span class="n">grid_shown</span><span class="p">:</span>
            <span class="n">edits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="o">.</span><span class="n">get_grid_dict</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">stim</span> <span class="ow">in</span> <span class="n">to_run</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">edits</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">stim</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NullColour</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_text_color</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_status_text</span><span class="p">(</span><span class="s1">&#39;running...&#39;</span><span class="p">)</span>

            <span class="n">fps</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">dropped</span><span class="p">,</span> <span class="n">time_stamp</span> <span class="o">=</span> <span class="n">StimProgram</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">to_run</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">time</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                <span class="n">status_text</span> <span class="o">=</span> <span class="s1">&#39;Last run: </span><span class="si">{0:.2f}</span><span class="s1"> fps, &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span> \
                              <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1"> seconds, &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> \
                              <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> dropped.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dropped</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_stamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">status_text</span> <span class="o">+=</span> <span class="s1">&#39; Timestamp: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_stamp</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_status_text</span><span class="p">(</span><span class="n">status_text</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dropped</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">BLUE</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_text_color</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>

            <span class="c1"># if error</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_status_text</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fps</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">BLUE</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">set_text_color</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="MyFrame.on_win_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyFrame.on_win_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_win_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for toggling stim window. Makes call to StimProgram. Gets</span>
<span class="sd">        various params from global panel.</span>

<span class="sd">        :param event: event passed by binder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_open</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_stop_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">StimProgram</span><span class="o">.</span><span class="n">MyWindow</span><span class="o">.</span><span class="n">close_win</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win_open</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">global_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_global_params</span><span class="p">()</span>
            <span class="c1"># adjust screen number to zero based index</span>
            <span class="n">global_defaults</span><span class="p">[</span><span class="s1">&#39;screen_num&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="c1"># offset needs to be passed as a scale relative to display size</span>
            <span class="n">global_defaults</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">global_defaults</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">],</span>
                <span class="n">global_defaults</span><span class="p">[</span><span class="s1">&#39;display_size&#39;</span><span class="p">])]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">win_open</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># pass global defaults to stim program</span>
            <span class="n">StimProgram</span><span class="o">.</span><span class="n">GlobalDefaults</span><span class="p">(</span><span class="o">**</span><span class="n">global_defaults</span><span class="p">)</span>
            <span class="c1"># make window</span>
            <span class="n">StimProgram</span><span class="o">.</span><span class="n">MyWindow</span><span class="o">.</span><span class="n">make_win</span><span class="p">()</span></div>

<div class="viewcode-block" id="MyFrame.on_stop_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyFrame.on_stop_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_stop_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for stopping stim. Makes call to StimProgram.</span>

<span class="sd">        :param event: event passed by binder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_break</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">StimProgram</span><span class="o">.</span><span class="n">MyWindow</span><span class="o">.</span><span class="n">should_break</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MyFrame.on_exit_button"><a class="viewcode-back" href="../gui.html#StimProgramGUI.MyFrame.on_exit_button">[docs]</a>    <span class="k">def</span> <span class="nf">on_exit_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes application.</span>

<span class="sd">        :param event: event passed by binder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_open</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_stop_button</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">StimProgram</span><span class="o">.</span><span class="n">MyWindow</span><span class="o">.</span><span class="n">close_win</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../gui.html#StimProgramGUI.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to start GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># instantiate app</span>
    <span class="k">global</span> <span class="n">app</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># instantiate window</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">MyFrame</span><span class="p">()</span>
    <span class="c1"># run app</span>
    <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Stimulus Program 1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Alexander Tomlinson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>